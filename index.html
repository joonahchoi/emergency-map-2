<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš‘ ìš°ë¦¬ ë™ë„¤ ì‘ê¸‰ì˜ë£Œê¸°ê´€ ì°¾ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #00acc1 0%, #00838f 100%);
            padding: 25px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 16px;
            opacity: 0.95;
        }

        .controls {
            padding: 20px;
            background: #e0f2f1;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            border-bottom: 3px solid #00acc1;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-label {
            font-weight: bold;
            color: #00838f;
            font-size: 14px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-radius {
            background: white;
            color: #00838f;
            border: 2px solid #00acc1;
        }

        .btn-radius.active {
            background: #00acc1;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: #ff6f61;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .map-container {
            position: relative;
            height: 500px;
            background: #f5f5f5;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e0f2f1;
            border-top: 5px solid #00acc1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .list-container {
            padding: 25px;
            max-height: 600px;
            overflow-y: auto;
        }

        .list-header {
            font-size: 22px;
            font-weight: bold;
            color: #00838f;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #00acc1;
        }

        .place-item {
            background: #f5f5f5;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 12px;
            border-left: 5px solid #00acc1;
            cursor: pointer;
            transition: all 0.2s;
        }

        .place-item:hover {
            background: #e0f2f1;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .place-name {
            font-size: 18px;
            font-weight: bold;
            color: #00838f;
            margin-bottom: 8px;
        }

        .place-category {
            display: inline-block;
            padding: 4px 12px;
            background: #00acc1;
            color: white;
            border-radius: 15px;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .place-info {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .place-distance {
            color: #00acc1;
            font-weight: bold;
            margin-top: 5px;
        }

        .place-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
            border-radius: 8px;
        }

        .footer {
            background: #00acc1;
            color: white;
            padding: 25px;
            text-align: center;
        }

        .footer-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .footer-content {
            line-height: 1.8;
            opacity: 0.95;
        }

        .empty-message {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 16px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #4caf50;
            color: white;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 24px;
            }

            .controls {
                flex-direction: column;
            }

            .map-container {
                height: 400px;
            }

            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš‘ ìš°ë¦¬ ë™ë„¤ ì‘ê¸‰ì˜ë£Œê¸°ê´€ ì°¾ê¸°</h1>
            <p>ì¤‘í•™êµ ë³´ê±´êµê³¼ 'ì‘ê¸‰ì²˜ì¹˜' ë‹¨ì› ì—°ê³„ êµìœ¡ ìë£Œ</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <span class="control-label">ğŸ” ê²€ìƒ‰ ë°˜ê²½:</span>
                <button class="btn btn-radius" onclick="changeRadius(3000)">3km</button>
                <button class="btn btn-radius active" onclick="changeRadius(5000)">5km</button>
                <button class="btn btn-radius" onclick="changeRadius(10000)">10km</button>
            </div>
            <button class="btn btn-primary" onclick="searchPlaces()">ğŸ“ ë‚´ ìœ„ì¹˜ì—ì„œ ë‹¤ì‹œ ê²€ìƒ‰</button>
        </div>

        <div class="map-container">
            <div id="map"></div>
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <div>ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <div class="list-container">
            <div class="list-header">ğŸ“‹ ê²€ìƒ‰ëœ ì‘ê¸‰ì˜ë£Œê¸°ê´€ ëª©ë¡ <span id="count" class="status-badge">0ê°œ</span></div>
            <div id="placesList">
                <div class="empty-message">ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ë³€ ì‘ê¸‰ì˜ë£Œê¸°ê´€ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.</div>
            </div>
        </div>

        <div class="footer">
            <div class="footer-title">ğŸ’¡ ì‘ê¸‰ìƒí™© ëŒ€ì²˜ë²•</div>
            <div class="footer-content">
                ì‘ê¸‰ìƒí™©ì´ ë°œìƒí–ˆì„ ë•ŒëŠ” <strong>119</strong>ì— ì‹ ê³ í•˜ê³ , ê°€ê¹Œìš´ ì‘ê¸‰ì˜ë£Œê¸°ê´€ì„ í™•ì¸í•˜ì„¸ìš”.<br>
                ì´ ì§€ë„ëŠ” í•™ìŠµìš©ìœ¼ë¡œ ì œì‘ë˜ì—ˆìœ¼ë©°, Kakao ì§€ë„ APIë¥¼ í™œìš©í•©ë‹ˆë‹¤.<br>
                ì‹¤ì œ ì‘ê¸‰ìƒí™©ì—ì„œëŠ” ë°˜ë“œì‹œ 119ì— ì—°ë½í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=c76378cfce34b51a13162d0b2c9705c2&libraries=services,clusterer"></script>
    <script>
        const REST_KEY = "481144fd197c15cc2cb5b2b0b9ba2912";
        
        let map;
        let currentPosition;
        let markers = [];
        let currentRadius = 5000;
        let places = [];

        // ì§€ë„ ì´ˆê¸°í™”
        function initMap() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        currentPosition = { lat, lng };
                        
                        const container = document.getElementById('map');
                        const options = {
                            center: new kakao.maps.LatLng(lat, lng),
                            level: 5
                        };
                        
                        map = new kakao.maps.Map(container, options);
                        
                        // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤
                        const marker = new kakao.maps.Marker({
                            position: new kakao.maps.LatLng(lat, lng),
                            map: map
                        });
                        
                        const infowindow = new kakao.maps.InfoWindow({
                            content: '<div style="padding:5px;font-size:12px;">ğŸ“ í˜„ì¬ ìœ„ì¹˜</div>'
                        });
                        infowindow.open(map, marker);
                        
                        document.getElementById('loading').style.display = 'none';
                        
                        // ìë™ìœ¼ë¡œ ì²« ê²€ìƒ‰ ì‹¤í–‰
                        searchPlaces();
                    },
                    error => {
                        alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                        document.getElementById('loading').style.display = 'none';
                    }
                );
            } else {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                document.getElementById('loading').style.display = 'none';
            }
        }

        // ë°˜ê²½ ë³€ê²½
        function changeRadius(radius) {
            currentRadius = radius;
            document.querySelectorAll('.btn-radius').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (currentPosition) {
                searchPlaces();
            }
        }

        // ì¥ì†Œ ê²€ìƒ‰
        async function searchPlaces() {
            if (!currentPosition) {
                alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ë¨¼ì € ê°€ì ¸ì™€ì£¼ì„¸ìš”.');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            places = [];
            clearMarkers();

            const keywords = ['ì‘ê¸‰ì‹¤', 'ë³‘ì›', 'ë³´ê±´ì†Œ'];
            
            for (const keyword of keywords) {
                await searchByKeyword(keyword);
            }

            displayPlaces();
            document.getElementById('loading').style.display = 'none';
        }

        // í‚¤ì›Œë“œë³„ ê²€ìƒ‰
        async function searchByKeyword(keyword) {
            const url = `https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(keyword)}&x=${currentPosition.lng}&y=${currentPosition.lat}&radius=${currentRadius}&size=15`;

            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `KakaoAK ${REST_KEY}`
                    }
                });

                const data = await response.json();
                
                if (data.documents) {
                    data.documents.forEach(place => {
                        // ì¤‘ë³µ ì²´í¬
                        if (!places.find(p => p.id === place.id)) {
                            places.push({
                                id: place.id,
                                name: place.place_name,
                                category: keyword,
                                address: place.address_name,
                                phone: place.phone || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ',
                                x: parseFloat(place.x),
                                y: parseFloat(place.y),
                                distance: place.distance,
                                place_url: place.place_url
                            });
                        }
                    });
                }
            } catch (error) {
                console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
            }
        }

        // ë§ˆì»¤ ì´ˆê¸°í™”
        function clearMarkers() {
            markers.forEach(marker => marker.setMap(null));
            markers = [];
        }

        // ì¥ì†Œ ëª©ë¡ í‘œì‹œ
        function displayPlaces() {
            const listEl = document.getElementById('placesList');
            const countEl = document.getElementById('count');
            
            // ê±°ë¦¬ìˆœ ì •ë ¬
            places.sort((a, b) => parseInt(a.distance) - parseInt(b.distance));
            
            countEl.textContent = `${places.length}ê°œ`;
            
            if (places.length === 0) {
                listEl.innerHTML = '<div class="empty-message">ê²€ìƒ‰ëœ ì‘ê¸‰ì˜ë£Œê¸°ê´€ì´ ì—†ìŠµë‹ˆë‹¤. ë°˜ê²½ì„ ë„“í˜€ë³´ì„¸ìš”.</div>';
                return;
            }

            let html = '';
            places.forEach((place, index) => {
                const distance = (parseInt(place.distance) / 1000).toFixed(2);
                
                html += `
                    <div class="place-item" onclick="moveToPlace(${index})">
                        <div class="place-category">${place.category}</div>
                        <div class="place-name">${place.name}</div>
                        <div class="place-info">
                            ğŸ“ ${place.address}<br>
                            â˜ï¸ ${place.phone}
                        </div>
                        <div class="place-distance">ğŸ“ ê±°ë¦¬: ${distance}km</div>
                        <div class="place-actions">
                            <button class="btn btn-primary btn-small" onclick="event.stopPropagation(); window.open('${place.place_url}', '_blank')">
                                ğŸ—ºï¸ ì¹´ì¹´ì˜¤ë§µì—ì„œ ë³´ê¸°
                            </button>
                            <button class="btn btn-small" style="background:#4caf50;color:white;" onclick="event.stopPropagation(); openNavigation(${place.y}, ${place.x})">
                                ğŸš— ê¸¸ì°¾ê¸°
                            </button>
                        </div>
                    </div>
                `;

                // ì§€ë„ì— ë§ˆì»¤ ì¶”ê°€
                const position = new kakao.maps.LatLng(place.y, place.x);
                const marker = new kakao.maps.Marker({
                    position: position,
                    map: map
                });

                const infowindow = new kakao.maps.InfoWindow({
                    content: `<div style="padding:10px;font-size:13px;white-space:nowrap;"><strong>${place.name}</strong><br>${place.category}</div>`
                });

                kakao.maps.event.addListener(marker, 'click', function() {
                    infowindow.open(map, marker);
                    map.setCenter(position);
                });

                markers.push(marker);
            });

            listEl.innerHTML = html;
        }

        // íŠ¹ì • ì¥ì†Œë¡œ ì´ë™
        function moveToPlace(index) {
            const place = places[index];
            const position = new kakao.maps.LatLng(place.y, place.x);
            map.setCenter(position);
            map.setLevel(3);
            
            // í•´ë‹¹ ë§ˆì»¤ì˜ ì¸í¬ìœˆë„ìš° ì—´ê¸°
            kakao.maps.event.trigger(markers[index], 'click');
        }

        // ê¸¸ì°¾ê¸°
        function openNavigation(lat, lng) {
            const url = `https://map.kakao.com/link/to/ëª©ì ì§€,${lat},${lng}`;
            window.open(url, '_blank');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì§€ë„ ì´ˆê¸°í™”
        window.onload = function() {
            // Kakao Maps APIê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (typeof kakao !== 'undefined' && kakao.maps) {
                initMap();
            } else {
                document.getElementById('loading').innerHTML = `
                    <div>âš ï¸ Kakao Maps API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.</div>
                    <div style="margin-top:15px;font-size:14px;line-height:1.6;">
                        1. <a href="https://developers.kakao.com" target="_blank" style="color:#00acc1;font-weight:bold;">developers.kakao.com</a>ì—ì„œ ì•± ë“±ë¡<br>
                        2. JavaScript í‚¤ì™€ REST API í‚¤ ë°œê¸‰<br>
                        3. HTML íŒŒì¼ì˜ YOUR_JAVASCRIPT_KEY_HEREì™€<br>
                        YOUR_REST_API_KEY_HEREë¥¼ êµì²´í•˜ì„¸ìš”.
                    </div>
                `;
            }
        };
    </script>
</body>
</html>
