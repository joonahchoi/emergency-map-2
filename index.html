<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥ ê±´ê°• ìì› ì°¾ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-navigation {
            background: linear-gradient(135deg, #00838f 0%, #006064 100%);
            padding: 0;
            display: flex;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-button {
            background: transparent;
            color: rgba(255,255,255,0.8);
            border: none;
            padding: 20px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            flex: 1;
            max-width: 300px;
        }

        .tab-button:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .tab-button.active {
            background: rgba(255,255,255,0.15);
            color: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #00e5ff;
        }

        /* í˜ì´ì§€ ì»¨í…ì¸  */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        .header {
            background: linear-gradient(135deg, #00acc1 0%, #00838f 100%);
            padding: 25px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 16px;
            opacity: 0.95;
        }

        .controls {
            padding: 20px;
            background: #e0f2f1;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            border-bottom: 3px solid #00acc1;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: #ff6f61;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .map-container {
            position: relative;
            height: 500px;
            background: #f5f5f5;
        }

        .map {
            width: 100%;
            height: 100%;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e0f2f1;
            border-top: 5px solid #00acc1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .list-container {
            padding: 25px;
            max-height: 600px;
            overflow-y: auto;
        }

        .list-header {
            font-size: 22px;
            font-weight: bold;
            color: #00838f;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #00acc1;
        }

        .place-item {
            background: #f5f5f5;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 12px;
            border-left: 5px solid #00acc1;
            cursor: pointer;
            transition: all 0.2s;
        }

        .place-item:hover {
            background: #e0f2f1;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .place-name {
            font-size: 18px;
            font-weight: bold;
            color: #00838f;
            margin-bottom: 8px;
        }

        .place-category {
            display: inline-block;
            padding: 4px 12px;
            background: #00acc1;
            color: white;
            border-radius: 15px;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .place-info {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .place-distance {
            color: #00acc1;
            font-weight: bold;
            margin-top: 5px;
        }

        .place-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
            border-radius: 8px;
        }

        .footer {
            background: #00acc1;
            color: white;
            padding: 25px;
            text-align: center;
        }

        .footer-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .footer-content {
            line-height: 1.8;
            opacity: 0.95;
        }

        .empty-message {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 16px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #4caf50;
            color: white;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 10px;
        }

        /* ê²Œì„ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .game-container {
            padding: 40px;
            text-align: center;
        }

        .game-title {
            font-size: 36px;
            color: #00838f;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .game-description {
            font-size: 18px;
            color: #666;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .game-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .game-card {
            background: linear-gradient(135deg, #fff 0%, #f5f5f5 100%);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .game-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            border-color: #00acc1;
        }

        .game-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .game-card-title {
            font-size: 22px;
            font-weight: bold;
            color: #00838f;
            margin-bottom: 10px;
        }

        .game-card-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }

        .quiz-section {
            background: #e0f2f1;
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
        }

        .quiz-title {
            font-size: 24px;
            color: #00838f;
            margin-bottom: 20px;
        }

        .quiz-question {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: left;
        }

        .quiz-btn {
            background: #00acc1;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        .quiz-btn:hover {
            background: #00838f;
        }

        @media (max-width: 768px) {
            .tab-button {
                padding: 15px 10px;
                font-size: 14px;
            }

            .header h1 {
                font-size: 24px;
            }

            .controls {
                flex-direction: column;
            }

            .map-container {
                height: 400px;
            }

            .game-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="showPage('game')">ğŸ® ê±´ê°• ìì› ì°¾ê¸° ê²Œì„</button>
            <button class="tab-button" onclick="showPage('physical')">ğŸ¥ ë¬¼ì  ê±´ê°• ìì› ì°¾ê¸°</button>
            <button class="tab-button" onclick="showPage('social')">ğŸ¤ ì‚¬íšŒì  ê±´ê°• ìì› ì°¾ê¸°</button>
        </div>

        <!-- ê±´ê°• ìì› ì°¾ê¸° ê²Œì„ í˜ì´ì§€ -->
        <div id="game-page" class="page-content active">
            <div class="game-container">
                <h1 class="game-title">ğŸ¯ ê±´ê°• ìì› ì°¾ê¸° ê²Œì„</h1>
                <p class="game-description">
                    ìš°ë¦¬ ì£¼ë³€ì˜ ê±´ê°• ìì›ì„ ì°¾ì•„ë³´ê³ , ì˜¬ë°”ë¥¸ í™œìš©ë²•ì„ ë°°ì›Œë´…ì‹œë‹¤!<br>
                    ê±´ê°•í•œ ì‚¶ì„ ìœ„í•´ í•„ìš”í•œ ë‹¤ì–‘í•œ ìì›ë“¤ì„ ê²Œì„ì„ í†µí•´ ì¬ë¯¸ìˆê²Œ ì•Œì•„ë³´ì„¸ìš”.
                </p>

                <div class="game-cards">
                    <div class="game-card" onclick="showPage('physical')">
                        <div class="game-icon">ğŸ¥</div>
                        <div class="game-card-title">ë¬¼ì  ê±´ê°• ìì›</div>
                        <div class="game-card-desc">
                            ë³‘ì›, ì‘ê¸‰ì‹¤, ë³´ê±´ì†Œ ë“±<br>
                            ì˜ë£Œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ê¸°ê´€ë“¤ì„<br>
                            ì°¾ì•„ë³´ì„¸ìš”!
                        </div>
                    </div>

                    <div class="game-card" onclick="showPage('social')">
                        <div class="game-icon">ğŸ¤</div>
                        <div class="game-card-title">ì‚¬íšŒì  ê±´ê°• ìì›</div>
                        <div class="game-card-desc">
                            í•´ë°”ë¼ê¸°ì„¼í„°, ì²­ì†Œë…„ì„±ë¬¸í™”ì„¼í„°,<br>
                            ì •ì‹ ê±´ê°•ë³µì§€ì„¼í„° ë“± ì‹¬ë¦¬Â·ì‚¬íšŒì <br>
                            ì§€ì› ê¸°ê´€ë“¤ì„ ì°¾ì•„ë³´ì„¸ìš”!
                        </div>
                    </div>

                    <div class="game-card" onclick="startQuiz()">
                        <div class="game-icon">ğŸ“</div>
                        <div class="game-card-title">ê±´ê°• ìì› í€´ì¦ˆ</div>
                        <div class="game-card-desc">
                            ê±´ê°• ìì›ì— ëŒ€í•œ<br>
                            ì—¬ëŸ¬ë¶„ì˜ ì§€ì‹ì„<br>
                            í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”!
                        </div>
                    </div>
                </div>

                <div class="quiz-section" id="quiz-section" style="display:none;">
                    <h2 class="quiz-title">ğŸ§  ê±´ê°• ìì› OX í€´ì¦ˆ</h2>
                    <div id="quiz-content"></div>
                    <button class="quiz-btn" onclick="checkQuiz()">ì •ë‹µ í™•ì¸í•˜ê¸°</button>
                </div>
            </div>

            <div class="footer">
                <div class="footer-title">ğŸ’¡ í•™ìŠµ ëª©í‘œ</div>
                <div class="footer-content">
                    â€¢ ìš°ë¦¬ ì§€ì—­ì˜ ê±´ê°• ìì›ì„ íŒŒì•…í•˜ê³  í™œìš© ë°©ë²•ì„ ìµí™ë‹ˆë‹¤.<br>
                    â€¢ ì‘ê¸‰ ìƒí™© ì‹œ ì ì ˆí•œ ëŒ€ì²˜ ë°©ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤.<br>
                    â€¢ ì •ì‹ ê±´ê°•ê³¼ ì‚¬íšŒì  ì§€ì› ì²´ê³„ì˜ ì¤‘ìš”ì„±ì„ ì´í•´í•©ë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- ë¬¼ì  ê±´ê°• ìì› ì°¾ê¸° í˜ì´ì§€ -->
        <div id="physical-page" class="page-content">
            <div class="header">
                <h1>ğŸ¥ ë¬¼ì  ê±´ê°• ìì› ì°¾ê¸°</h1>
                <p>ìš°ë¦¬ ë™ë„¤ ì‘ê¸‰ì˜ë£Œê¸°ê´€ ë° ë³´ê±´ì˜ë£Œì‹œì„¤ ì°¾ê¸°</p>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="searchPhysicalPlaces()">ğŸ“ ë‚´ ìœ„ì¹˜ì—ì„œ ê²€ìƒ‰í•˜ê¸°</button>
            </div>

            <div class="map-container">
                <div id="physical-map" class="map"></div>
                <div class="loading" id="physical-loading" style="display:none;">
                    <div class="loading-spinner"></div>
                    <div>ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>

            <div class="list-container">
                <div class="list-header">ğŸ“‹ ê²€ìƒ‰ëœ ì˜ë£Œê¸°ê´€ ëª©ë¡ <span id="physical-count" class="status-badge">0ê°œ</span></div>
                <div id="physical-placesList">
                    <div class="empty-message">ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ë³€ ì˜ë£Œê¸°ê´€ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.</div>
                </div>
            </div>

            <div class="footer">
                <div class="footer-title">ğŸ’¡ ì‘ê¸‰ìƒí™© ëŒ€ì²˜ë²•</div>
                <div class="footer-content">
                    ì‘ê¸‰ìƒí™©ì´ ë°œìƒí–ˆì„ ë•ŒëŠ” <strong>119</strong>ì— ì‹ ê³ í•˜ê³ , ê°€ê¹Œìš´ ì‘ê¸‰ì˜ë£Œê¸°ê´€ì„ í™•ì¸í•˜ì„¸ìš”.<br>
                    ë³‘ì› ì´ìš© ì‹œ ì¦ìƒì„ ì •í™•íˆ ì„¤ëª…í•˜ê³ , í•„ìš”í•œ ì„œë¥˜ë¥¼ ì¤€ë¹„í•˜ì„¸ìš”.<br>
                    ì‹¤ì œ ì‘ê¸‰ìƒí™©ì—ì„œëŠ” ë°˜ë“œì‹œ 119ì— ì—°ë½í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- ì‚¬íšŒì  ê±´ê°• ìì› ì°¾ê¸° í˜ì´ì§€ -->
        <div id="social-page" class="page-content">
            <div class="header">
                <h1>ğŸ¤ ì‚¬íšŒì  ê±´ê°• ìì› ì°¾ê¸°</h1>
                <p>ìš°ë¦¬ ë™ë„¤ ì‹¬ë¦¬Â·ì‚¬íšŒ ì§€ì› ê¸°ê´€ ì°¾ê¸°</p>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="searchSocialPlaces()">ğŸ“ ë‚´ ìœ„ì¹˜ì—ì„œ ê²€ìƒ‰í•˜ê¸°</button>
            </div>

            <div class="map-container">
                <div id="social-map" class="map"></div>
                <div class="loading" id="social-loading" style="display:none;">
                    <div class="loading-spinner"></div>
                    <div>ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>

            <div class="list-container">
                <div class="list-header">ğŸ“‹ ê²€ìƒ‰ëœ ì§€ì›ê¸°ê´€ ëª©ë¡ <span id="social-count" class="status-badge">0ê°œ</span></div>
                <div id="social-placesList">
                    <div class="empty-message">ìœ„ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ë³€ ì§€ì›ê¸°ê´€ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.</div>
                </div>
            </div>

            <div class="footer">
                <div class="footer-title">ğŸ’¡ ì‚¬íšŒì  ê±´ê°• ìì› ì´ìš© ì•ˆë‚´</div>
                <div class="footer-content">
                    <strong>í•´ë°”ë¼ê¸°ì„¼í„°</strong>: ì„±í­ë ¥Â·ê°€ì •í­ë ¥ í”¼í•´ì ì§€ì› (êµ­ë²ˆì—†ì´ 1366)<br>
                    <strong>ì²­ì†Œë…„ì„±ë¬¸í™”ì„¼í„°</strong>: ì²­ì†Œë…„ ì„±êµìœ¡ ë° ìƒë‹´ ì§€ì›<br>
                    <strong>ì •ì‹ ê±´ê°•ë³µì§€ì„¼í„°</strong>: ì •ì‹ ê±´ê°• ìƒë‹´ ë° ì¹˜ë£Œ ì—°ê³„ (ì •ì‹ ê±´ê°• ìœ„ê¸°ìƒë‹´ 1577-0199)<br>
                    ë„ì›€ì´ í•„ìš”í•  ë•Œ ì£¼ì €í•˜ì§€ ë§ê³  ì—°ë½í•˜ì„¸ìš”. ëª¨ë“  ìƒë‹´ì€ ë¹„ë°€ì´ ë³´ì¥ë©ë‹ˆë‹¤.
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=c76378cfce34b51a13162d0b2c9705c2&libraries=services,clusterer"></script>
    <script>
        const REST_KEY = "481144fd197c15cc2cb5b2b0b9ba2912";
        
        let physicalMap, socialMap;
        let currentPosition;
        let physicalMarkers = [];
        let socialMarkers = [];
        let physicalPlaces = [];
        let socialPlaces = [];
        const searchRadius = 10000; // 10km ê³ ì •

        // í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜
        function showPage(pageName) {
            // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ì„ íƒëœ í˜ì´ì§€ ë³´ì´ê¸°
            document.getElementById(`${pageName}-page`).classList.add('active');
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            
            // ì§€ë„ ì´ˆê¸°í™” (í•„ìš”í•œ ê²½ìš°)
            if (pageName === 'physical' && !physicalMap) {
                initPhysicalMap();
            } else if (pageName === 'social' && !socialMap) {
                initSocialMap();
            }
        }

        // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        function getCurrentPosition() {
            return new Promise((resolve, reject) => {
                if (!currentPosition) {
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            position => {
                                currentPosition = {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude
                                };
                                resolve(currentPosition);
                            },
                            error => {
                                alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.');
                                reject(error);
                            }
                        );
                    } else {
                        alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                        reject();
                    }
                } else {
                    resolve(currentPosition);
                }
            });
        }

        // ë¬¼ì  ê±´ê°• ìì› ì§€ë„ ì´ˆê¸°í™”
        async function initPhysicalMap() {
            try {
                const pos = await getCurrentPosition();
                const container = document.getElementById('physical-map');
                const options = {
                    center: new kakao.maps.LatLng(pos.lat, pos.lng),
                    level: 5
                };
                
                physicalMap = new kakao.maps.Map(container, options);
                
                // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤
                const marker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng(pos.lat, pos.lng),
                    map: physicalMap
                });
                
                const infowindow = new kakao.maps.InfoWindow({
                    content: '<div style="padding:5px;font-size:12px;">ğŸ“ í˜„ì¬ ìœ„ì¹˜</div>'
                });
                infowindow.open(physicalMap, marker);
            } catch (error) {
                console.error('ì§€ë„ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            }
        }

        // ì‚¬íšŒì  ê±´ê°• ìì› ì§€ë„ ì´ˆê¸°í™”
        async function initSocialMap() {
            try {
                const pos = await getCurrentPosition();
                const container = document.getElementById('social-map');
                const options = {
                    center: new kakao.maps.LatLng(pos.lat, pos.lng),
                    level: 5
                };
                
                socialMap = new kakao.maps.Map(container, options);
                
                // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤
                const marker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng(pos.lat, pos.lng),
                    map: socialMap
                });
                
                const infowindow = new kakao.maps.InfoWindow({
                    content: '<div style="padding:5px;font-size:12px;">ğŸ“ í˜„ì¬ ìœ„ì¹˜</div>'
                });
                infowindow.open(socialMap, marker);
            } catch (error) {
                console.error('ì§€ë„ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            }
        }

        // ë¬¼ì  ê±´ê°• ìì› ê²€ìƒ‰
        async function searchPhysicalPlaces() {
            document.getElementById('physical-loading').style.display = 'block';
            
            try {
                const pos = await getCurrentPosition();
                
                if (!physicalMap) {
                    await initPhysicalMap();
                }
                
                physicalPlaces = [];
                clearMarkers(physicalMarkers);

                const keywords = ['ì‘ê¸‰ì‹¤', 'ë³‘ì›', 'ë³´ê±´ì†Œ', 'ì•½êµ­'];
                
                for (const keyword of keywords) {
                    await searchByKeyword(keyword, 'physical');
                }

                displayPlaces('physical');
            } catch (error) {
                console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
            } finally {
                document.getElementById('physical-loading').style.display = 'none';
            }
        }

        // ì‚¬íšŒì  ê±´ê°• ìì› ê²€ìƒ‰
        async function searchSocialPlaces() {
            document.getElementById('social-loading').style.display = 'block';
            
            try {
                const pos = await getCurrentPosition();
                
                if (!socialMap) {
                    await initSocialMap();
                }
                
                socialPlaces = [];
                clearMarkers(socialMarkers);

                const keywords = ['í•´ë°”ë¼ê¸°ì„¼í„°', 'ì²­ì†Œë…„ì„±ë¬¸í™”ì„¼í„°', 'ì •ì‹ ê±´ê°•ë³µì§€ì„¼í„°', 'ì²­ì†Œë…„ìƒë‹´ë³µì§€ì„¼í„°', 'ê°€ì¡±ì„¼í„°'];
                
                for (const keyword of keywords) {
                    await searchByKeyword(keyword, 'social');
                }

                displayPlaces('social');
            } catch (error) {
                console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
            } finally {
                document.getElementById('social-loading').style.display = 'none';
            }
        }

        // í‚¤ì›Œë“œë³„ ê²€ìƒ‰
        async function searchByKeyword(keyword, type) {
            const url = `https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(keyword)}&x=${currentPosition.lng}&y=${currentPosition.lat}&radius=${searchRadius}&size=15`;

            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `KakaoAK ${REST_KEY}`
                    }
                });

                const data = await response.json();
                const targetArray = type === 'physical' ? physicalPlaces : socialPlaces;
                
                if (data.documents) {
                    data.documents.forEach(place => {
                        // ì¤‘ë³µ ì²´í¬
                        if (!targetArray.find(p => p.id === place.id)) {
                            targetArray.push({
                                id: place.id,
                                name: place.place_name,
                                category: keyword,
                                address: place.address_name,
                                phone: place.phone || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ',
                                x: parseFloat(place.x),
                                y: parseFloat(place.y),
                                distance: place.distance,
                                place_url: place.place_url
                            });
                        }
                    });
                }
            } catch (error) {
                console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
            }
        }

        // ë§ˆì»¤ ì´ˆê¸°í™”
        function clearMarkers(markers) {
            markers.forEach(marker => marker.setMap(null));
            markers.length = 0;
        }

        // ì¥ì†Œ ëª©ë¡ í‘œì‹œ
        function displayPlaces(type) {
            const places = type === 'physical' ? physicalPlaces : socialPlaces;
            const listEl = document.getElementById(`${type}-placesList`);
            const countEl = document.getElementById(`${type}-count`);
            const map = type === 'physical' ? physicalMap : socialMap;
            const markers = type === 'physical' ? physicalMarkers : socialMarkers;
            
            // ê±°ë¦¬ìˆœ ì •ë ¬
            places.sort((a, b) => parseInt(a.distance) - parseInt(b.distance));
            
            countEl.textContent = `${places.length}ê°œ`;
            
            if (places.length === 0) {
                listEl.innerHTML = '<div class="empty-message">ê²€ìƒ‰ëœ ê¸°ê´€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            let html = '';
            places.forEach((place, index) => {
                const distance = (parseInt(place.distance) / 1000).toFixed(2);
                
                html += `
                    <div class="place-item" onclick="moveToPlace('${type}', ${index})">
                        <div class="place-category">${place.category}</div>
                        <div class="place-name">${place.name}</div>
                        <div class="place-info">
                            ğŸ“ ${place.address}<br>
                            â˜ï¸ ${place.phone}
                        </div>
                        <div class="place-distance">ğŸ“ ê±°ë¦¬: ${distance}km</div>
                        <div class="place-actions">
                            <button class="btn btn-primary btn-small" onclick="event.stopPropagation(); window.open('${place.place_url}', '_blank')">
                                ğŸ—ºï¸ ì¹´ì¹´ì˜¤ë§µì—ì„œ ë³´ê¸°
                            </button>
                            <button class="btn btn-small" style="background:#4caf50;color:white;" onclick="event.stopPropagation(); openNavigation(${place.y}, ${place.x})">
                                ğŸš— ê¸¸ì°¾ê¸°
                            </button>
                        </div>
                    </div>
                `;

                // ì§€ë„ì— ë§ˆì»¤ ì¶”ê°€
                const position = new kakao.maps.LatLng(place.y, place.x);
                const marker = new kakao.maps.Marker({
                    position: position,
                    map: map
                });

                const infowindow = new kakao.maps.InfoWindow({
                    content: `<div style="padding:10px;font-size:13px;white-space:nowrap;"><strong>${place.name}</strong><br>${place.category}</div>`
                });

                kakao.maps.event.addListener(marker, 'click', function() {
                    infowindow.open(map, marker);
                    map.setCenter(position);
                });

                markers.push(marker);
            });

            listEl.innerHTML = html;
        }

        // íŠ¹ì • ì¥ì†Œë¡œ ì´ë™
        function moveToPlace(type, index) {
            const places = type === 'physical' ? physicalPlaces : socialPlaces;
            const map = type === 'physical' ? physicalMap : socialMap;
            const markers = type === 'physical' ? physicalMarkers : socialMarkers;
            
            const place = places[index];
            const position = new kakao.maps.LatLng(place.y, place.x);
            map.setCenter(position);
            map.setLevel(3);
            
            // í•´ë‹¹ ë§ˆì»¤ì˜ ì¸í¬ìœˆë„ìš° ì—´ê¸°
            kakao.maps.event.trigger(markers[index], 'click');
        }

        // ê¸¸ì°¾ê¸°
        function openNavigation(lat, lng) {
            const url = `https://map.kakao.com/link/to/ëª©ì ì§€,${lat},${lng}`;
            window.open(url, '_blank');
        }

        // í€´ì¦ˆ ì‹œì‘
        function startQuiz() {
            const quizSection = document.getElementById('quiz-section');
            const quizContent = document.getElementById('quiz-content');
            
            quizSection.style.display = 'block';
            
            const questions = [
                { q: "ì‘ê¸‰ìƒí™©ì´ ë°œìƒí•˜ë©´ 119ì— ì‹ ê³ í•´ì•¼ í•œë‹¤.", a: "O" },
                { q: "ë³´ê±´ì†ŒëŠ” ì˜ˆë°©ì ‘ì¢…ë§Œ í•  ìˆ˜ ìˆë‹¤.", a: "X" },
                { q: "í•´ë°”ë¼ê¸°ì„¼í„°ëŠ” ì„±í­ë ¥ í”¼í•´ìë¥¼ ì§€ì›í•˜ëŠ” ê¸°ê´€ì´ë‹¤.", a: "O" },
                { q: "ì •ì‹ ê±´ê°• ìƒë‹´ì€ ë¹„ë°€ì´ ë³´ì¥ëœë‹¤.", a: "O" },
                { q: "ì•½êµ­ì—ì„œëŠ” ì²˜ë°©ì „ ì—†ì´ ëª¨ë“  ì•½ì„ ì‚´ ìˆ˜ ìˆë‹¤.", a: "X" }
            ];
            
            let html = '';
            questions.forEach((q, i) => {
                html += `
                    <div class="quiz-question">
                        <strong>Q${i+1}.</strong> ${q.q}
                        <div style="margin-top:10px;">
                            <label style="margin-right:20px;">
                                <input type="radio" name="q${i}" value="O"> O
                            </label>
                            <label>
                                <input type="radio" name="q${i}" value="X"> X
                            </label>
                        </div>
                        <input type="hidden" id="answer${i}" value="${q.a}">
                    </div>
                `;
            });
            
            quizContent.innerHTML = html;
            
            // ìŠ¤í¬ë¡¤ ì´ë™
            quizSection.scrollIntoView({ behavior: 'smooth' });
        }

        // í€´ì¦ˆ ì •ë‹µ í™•ì¸
        function checkQuiz() {
            let score = 0;
            let total = 5;
            
            for (let i = 0; i < total; i++) {
                const userAnswer = document.querySelector(`input[name="q${i}"]:checked`);
                const correctAnswer = document.getElementById(`answer${i}`).value;
                
                if (userAnswer && userAnswer.value === correctAnswer) {
                    score++;
                }
            }
            
            alert(`ì •ë‹µ: ${score}/${total}ê°œ!\n${score === total ? 'ì™„ë²½í•´ìš”! ğŸ‰' : score >= 3 ? 'ì˜í–ˆì–´ìš”! ğŸ‘' : 'ë‹¤ì‹œ í•œë²ˆ ê³µë¶€í•´ë´ìš”! ğŸ’ª'}`);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            // Kakao Maps APIê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (typeof kakao === 'undefined' || !kakao.maps) {
                alert('Kakao Maps APIë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        };
    </script>
</body>
</html>
